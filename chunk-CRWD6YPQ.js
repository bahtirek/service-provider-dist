import{a as Q,b as Y}from"./chunk-NSKHBJVU.js";import{a as ue}from"./chunk-CFISRMDD.js";import{a as K}from"./chunk-VSMVFW52.js";import{a as ge}from"./chunk-O3OTT2BA.js";import{b as ce,d as me,f as de,q as G}from"./chunk-TEUQ36QL.js";import{a as pe}from"./chunk-XCYL4QET.js";import{a as he,b as fe}from"./chunk-LK5WJ2EN.js";import{a as q}from"./chunk-Q6P6KOMJ.js";import"./chunk-Y6NGLBTQ.js";import{c as j,e as H,f as $}from"./chunk-KZEZHTV3.js";import{$ as x,Aa as b,Fa as p,Ia as se,La as u,Ma as h,N as ee,Na as V,Oa as A,Pa as U,Qa as o,Ra as r,Sa as C,T,Ta as w,V as f,Xa as g,Y as te,Ya as d,Za as ae,_ as M,_a as oe,a as L,ab as m,bb as _,cb as re,db as B,f as Z,hb as v,jb as S,kb as z,mb as D,na as N,nb as le,ob as R,qb as O,ra as ie,rb as k,ta as ne,tb as F,xa as l}from"./chunk-TMRUMUQV.js";import{d as X}from"./chunk-JMZ7DUBM.js";var _e=(()=>{let i=class i{transform(e){let n=(e/1024).toFixed(2)+" KB";return e>1048576&&(n=(e/(1024*1024)).toFixed(2)+" MB"),n}};i.\u0275fac=function(n){return new(n||i)},i.\u0275pipe=te({name:"fileSize",type:i,pure:!0,standalone:!0});let t=i;return t})();var ve=t=>({"background-image":t});function Oe(t,i){if(t&1&&C(0,"div",4),t&2){let a=d();p("ngStyle",S(1,ve,a.fileUrl))}}function ke(t,i){if(t&1&&C(0,"div",4),t&2){let a=d();p("ngStyle",S(1,ve,a.fileUrl))}}function Fe(t,i){if(t&1&&(o(0,"div",5)(1,"div",6)(2,"span"),m(3),r()()()),t&2){let a=d();l(3),_(a.fileType)}}var Ce=(()=>{let i=class i{constructor(){this.fileUrl="",this.fileType="UNK",this.thumbnailEvent=new b}set fileProp(e){if(this.file=e,this.setFileType(e.type),this.fileType!="IMG")return;let n=new FileReader;n.onload=s=>{s.target&&(this.fileUrl=`url("${s.target.result}")`)},n.readAsDataURL(e)}setFileType(e){return X(this,null,function*(){if(e.includes("image"))this.fileType="IMG";else if(e.includes("pdf"))this.fileType="PDF";else if(e.includes("zip"))this.fileType="ZIP";else if(e.includes("document"))this.fileType="DOC";else if(e.includes("video")){if(e.includes("mp4")||e.includes("ogg")||e.includes("mov")||e.includes("webm")){let n=yield this.generateVideoThumbnail(this.file);this.fileUrl=`url("${n}")`,this.thumbnailEvent.emit(n)}this.fileType="VID"}else this.fileType="UNK"})}generateVideoThumbnail(e){return new Promise(n=>{let s=document.createElement("canvas"),c=document.createElement("video");c.autoplay=!0,c.muted=!0,c.src=URL.createObjectURL(e),c.onloadeddata=()=>{let y=s.getContext("2d"),P=c.videoWidth,E=c.videoHeight,J=P/E;return P>E?(P=100,E=P/J):(E=100,P=E*J),s.width=P,s.height=E,y==null?null:(y.drawImage(c,0,0,P,E),c.pause(),n(s.toDataURL("image/png")))}})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-file-details"]],inputs:{fileProp:"fileProp"},outputs:{thumbnailEvent:"thumbnailEvent"},standalone:!0,features:[v],decls:10,vars:5,consts:[[1,"flex","no-wrap","mb-sm"],["class","file-image",3,"ngStyle"],[1,"flex","column","justify-around","ml-md"],[1,"body2"],[1,"file-image",3,"ngStyle"],[1,"file-image"],[1,"file-type"]],template:function(n,s){n&1&&(o(0,"div",0),u(1,Oe,1,3,"div",1)(2,ke,1,3)(3,Fe,4,1),o(4,"div",2)(5,"div"),m(6),r(),o(7,"div",3),m(8),D(9,"fileSize"),r()()()),n&2&&(l(1),h(1,s.fileType=="IMG"?1:s.fileType=="VID"&&s.fileUrl?2:3),l(5),_(s.file==null?null:s.file.name),l(2),_(le(9,3,s.file==null?null:s.file.size)))},dependencies:[_e,H]});let t=i;return t})();function Ae(t,i){if(t&1&&(o(0,"h3",7),m(1),r()),t&2){let a=d();l(1),re("",a.files.length," files selected")}}function Ue(t,i){if(t&1){let a=w();o(0,"app-file-details",8),g("thumbnailEvent",function(n){let c=M(a).$index,y=d();return x(y.handleThumbnailEvent(n,c))}),r()}if(t&2){let a=i.$implicit;p("fileProp",a)}}var ye=(()=>{let i=class i{constructor(){this.comment="",this.cancel=new b,this.onFileUpload=new b,this.thumbnailEvent=new b}set filesProp(e){this.files=e}handleThumbnailEvent(e,n){this.thumbnailEvent.emit({thumbnail:e,index:n})}onCancel(){this.cancel.emit(!0)}onSend(){this.onFileUpload.emit(this.comment.trim()),this.comment=""}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-file-upload"]],inputs:{filesProp:"filesProp"},outputs:{cancel:"cancel",onFileUpload:"onFileUpload",thumbnailEvent:"thumbnailEvent"},standalone:!0,features:[v],decls:13,vars:2,consts:[["class","mb-lg"],[1,"form-element","mt-xxl"],["for","sessionTitle"],["type","text","id","sessionTitle",3,"ngModel","ngModelChange"],[1,"flex","mt-xl","btn-group"],[1,"block","ml-auto","btn-danger",3,"click"],[1,"block","ml-lg",3,"click"],[1,"mb-lg"],[3,"fileProp","thumbnailEvent"],[3,"fileProp"]],template:function(n,s){n&1&&(o(0,"div"),u(1,Ae,2,1,"h3",0),A(2,Ue,1,1,"app-file-details",9,V),o(4,"div",1)(5,"label",2),m(6,"Comment"),r(),o(7,"input",3),g("ngModelChange",function(y){return s.comment=y}),r()(),o(8,"div",4)(9,"button",5),g("click",function(){return s.onCancel()}),m(10,"Cancel"),r(),o(11,"button",6),g("click",function(){return s.onSend()}),m(12,"Send"),r()()()),n&2&&(l(1),h(1,s.files&&s.files.length>0?1:-1),l(1),U(s.files),l(5),p("ngModel",s.comment))},dependencies:[G,ce,me,de,Ce]});let t=i;return t})();var W=(()=>{let i=class i{constructor(){this.onMessageReplay=new Z,this.onMessageEdit=new Z}replyToMessage(e){this.onMessageReplay.next(e)}editMessage(e){this.onMessageEdit.next(e)}};i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"});let t=i;return t})();var Ve=t=>({"background-image":t});function De(t,i){if(t&1&&(o(0,"div",9)(1,"div",10),C(2,"div",11),r()()),t&2){let a=d();l(2),p("ngStyle",S(1,Ve,a.attachmentUrl))}}function je(t,i){if(t&1&&(o(0,"div",12),m(1),r()),t&2){let a=d();l(1),_(a.attachment.attachmentOriginalName)}}var Me=(()=>{let i=class i{constructor(){this.message={},this.attachmentUrl="",this.attachmentType="UNK",this.title="",this.cancelEmit=new b}set messageProp(e){this.reset(),this.message=e,this.setAttachment()}set isEditingProp(e){e?this.title="Editing message:":this.title=`Reply to ${this.message.receiver?.firstName} ${this.message.receiver?.lastName}`}setAttachment(){this.message.attachments.length!=0&&(this.attachment=this.message.attachments[0],this.attachment.thumbnailUrl!=null&&(this.attachmentUrl=`url("${this.attachment.thumbnailUrl}")`))}cancel(){this.reset(),this.cancelEmit.next()}reset(){this.message={},this.attachment={},this.attachmentUrl=""}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-reply-to-message-details"]],inputs:{messageProp:"messageProp",isEditingProp:"isEditingProp"},outputs:{cancelEmit:"cancelEmit"},standalone:!0,features:[v],decls:13,vars:4,consts:[[1,"reply-to-message-container"],[1,"material-symbols-outlined"],[1,"message-details"],["class","attachment mr-sm"],[1,"message-text"],[1,"text-primary","text-13","mb-xs","truncated"],["class","text-11 text-darkest truncated"],[1,"text-13","truncated"],[1,"material-symbols-outlined","text-primary","hoverable",3,"click"],[1,"attachment","mr-sm"],[1,"attachment-container"],[1,"file-image",3,"ngStyle"],[1,"text-11","text-darkest","truncated"]],template:function(n,s){n&1&&(o(0,"div",0)(1,"span",1),m(2,"reply"),r(),o(3,"div",2),u(4,De,3,3,"div",3),o(5,"div",4)(6,"div",5),m(7),r(),u(8,je,2,1,"div",6),o(9,"div",7),m(10),r()()(),o(11,"span",8),g("click",function(){return s.cancel()}),m(12,"close"),r()()),n&2&&(l(4),h(4,s.attachment!=null&&s.attachment.thumbnailUrl?4:-1),l(3),_(s.title),l(1),h(8,s.attachment&&!s.attachment.thumbnailUrl?8:-1),l(2),_(s.message.message))},dependencies:[H],styles:[".reply-to-message-container[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;padding:10px 10px 0}.reply-to-message-container[_ngcontent-%COMP%]   .message-details[_ngcontent-%COMP%]{width:100%;margin-left:5px;margin-right:10px;display:flex;flex-wrap:nowrap}.reply-to-message-container[_ngcontent-%COMP%]   .message-details[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{max-width:500px}@media (max-width: 767px){.reply-to-message-container[_ngcontent-%COMP%]   .message-details[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{max-width:250px}}.reply-to-message-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{width:50px;display:flex;justify-content:center;align-items:center;height:28px}"]});let t=i;return t})();var Ne=["textAreaContainer"],Re=["textArea"],He=["fileUpload"];function $e(t,i){if(t&1){let a=w();o(0,"app-reply-to-message-details",15),g("cancelEmit",function(){M(a);let n=d();return x(n.resetMessageInputField())}),r()}if(t&2){let a=d();p("messageProp",a.replyToMessage)("isEditingProp",a.messageToEditId)}}var xe=(()=>{let i=class i{constructor(){this.renderer=T(ie),this.auth=T(q),this.chatService=T(Y),this.subjectService=T(K),this.messageService=T(Q),this.replyService=T(W),this._subscription=new L,this.message="",this.showCursor=!0,this.toggleModal=!1,this.uploadInprogress=ne(0),this.videoThumbnails=[],this.replyToMessageId=null,this.replyToMessage={}}ngOnInit(){this._subscription.add(this.replyService.onMessageReplay.subscribe(e=>{this.resetMessageInputField(),this.replyToMessage=e,this.replyToMessageId=e.messageId})),this._subscription.add(this.replyService.onMessageEdit.subscribe(e=>{this.resetMessageInputField(),this.replyToMessage=e,this.messageToEditId=e.messageId,this.renderer.setAttribute(this.textAreaContainer.nativeElement,"data-replicated-value",e.message),this.textArea.nativeElement.value=e.message})),this.getSubjectDetails()}ngOnDestroy(){this._subscription.unsubscribe()}getSubjectDetails(){let e=this.subjectService.getSubjectFromLocal();e&&(this.subjectId=e.subjectId,this.chatService.setSubjectId(this.subjectId))}onSubmit(){if(!this.subjectId||!this.receiverId)return;let e=this.textAreaContainer.nativeElement.dataset.replicatedValue?.trim();e&&(this.messageToEditId?this.postEditedMessage(e):this.postNewOrReplyMessage(e))}postNewOrReplyMessage(e){let n={subjectId:this.subjectId,message:e,accessToken:this.auth.user().accessToken,toUserId:this.receiverId,replyToMessageId:this.replyToMessageId};this.chatService.sendMessage(n),this.resetMessageInputField()}postEditedMessage(e){console.log(e);let n={message:e,accessToken:this.auth.user().accessToken,messageId:this.messageToEditId};this.chatService.updateMessage(n),this.resetMessageInputField()}resetMessageInputField(){this.renderer.setAttribute(this.textAreaContainer.nativeElement,"data-replicated-value",""),this.textArea.nativeElement.value="",this.showCursor=!0,this.replyToMessage={},this.replyToMessageId=null,this.messageToEditId=void 0}onAttach(){let e=/(\.jpg|\.jpeg|\.bmp|\.gif|\.svg|\.png|\.webm|\.avi|\.mpeg|\.mkv|\.doc|\.docx|\.xls|\.xlsx|\.pdf)$/i,n=this.fileUpload.nativeElement.files;n&&n.length>0&&(this.files=n,this.toggleModal=!0)}onBlur(){this.textArea.nativeElement.value?this.showCursor=!1:this.showCursor=!0}submitAttachmentMessage(e){this.toggleModal=!1;let n={subjectId:this.subjectId,message:e,accessToken:this.auth.user().accessToken,toUserId:this.receiverId,isAttachment:!0,replyToMessageId:this.replyToMessageId};this.messageService.postAttachmentMessage(n).subscribe({next:s=>{s.totalUploads=this.files.length,this.messageService.addMessage(s),s.messageId&&this.submitFiles(s.messageId),this.resetMessageInputField()},error:s=>{console.log()}})}submitFiles(e){if(!this.files||this.files.length==0)return;let n=0;[...this.files].forEach(s=>{let c="",y=this.videoThumbnails.find(E=>E.index==n);y&&(c=y.thumbnail);let P=new FormData;P.append("file",s),P.append("messageId",e.toString()),P.append("thumbnailBlob",c),this.messageService.uploadFile(P).subscribe({next:E=>{this.messageService.updateMessage(E),this.chatService.sendAttchmentMessage(E,this.receiverId)},error:E=>{console.log(E)}}),n++})}handleThumbnailEvent(e){this.videoThumbnails.push(e)}onFocus(){this.showCursor=!1}cancel(){this.toggleModal=!1,this.fileUpload.nativeElement.value="",this.replyToMessage={},this.replyToMessageId=null,this.messageToEditId=void 0}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-message-toolbar"]],viewQuery:function(n,s){if(n&1&&(k(Ne,5),k(Re,5),k(He,5)),n&2){let c;O(c=F())&&(s.textAreaContainer=c.first),O(c=F())&&(s.textArea=c.first),O(c=F())&&(s.fileUpload=c.first)}},inputs:{receiverId:"receiverId"},standalone:!0,features:[v],decls:18,vars:3,consts:[[1,"message-toolbar-container"],[3,"messageProp","isEditingProp"],[1,"message-toolbar"],[1,"action-btn"],["for","attach"],[1,"material-symbols-outlined","text-primary"],["type","file","id","attach","accept","image/*, .pdf, .doc, .docx","multiple","",1,"hidden",3,"input"],["fileUpload",""],[1,"text-container"],["textAreaContainer",""],["onInput","this.parentNode.dataset.replicatedValue = this.value","rows","1","placeholder","Send message",3,"focus","blur"],["textArea",""],[1,"material-symbols-outlined","text-primary",3,"click"],[3,"modal","modalChange"],[3,"filesProp","cancel","onFileUpload","thumbnailEvent"],[3,"messageProp","isEditingProp","cancelEmit"]],template:function(n,s){n&1&&(o(0,"div",0),u(1,$e,1,2,"app-reply-to-message-details",1),o(2,"div",2)(3,"div",3)(4,"label",4)(5,"span",5),m(6,"attach_file"),r()(),o(7,"input",6,7),g("input",function(){return s.onAttach()}),r()(),o(9,"div",8,9)(11,"textarea",10,11),g("focus",function(){return s.onFocus()})("blur",function(){return s.onBlur()}),r()(),o(13,"div",3)(14,"span",12),g("click",function(){return s.onSubmit()}),m(15,"send"),r()()()(),o(16,"app-modal",13),g("modalChange",function(y){return s.toggleModal=y}),o(17,"app-file-upload",14),g("cancel",function(){return s.cancel()})("onFileUpload",function(y){return s.submitAttachmentMessage(y)})("thumbnailEvent",function(y){return s.handleThumbnailEvent(y)}),r()()),n&2&&(l(1),h(1,s.replyToMessageId||s.messageToEditId?1:-1),l(15),p("modal",s.toggleModal),l(1),p("filesProp",s.files))},dependencies:[G,ue,ye,Me],styles:['.message-toolbar-container[_ngcontent-%COMP%]{border:1px solid #d2d2d7;border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;background-color:#fff}@media (max-width: 767px){.message-toolbar-container[_ngcontent-%COMP%]{border:none}}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]{min-height:46px;display:flex;flex-wrap:nowrap;align-items:flex-end;justify-content:space-around;padding:10px 10px 12px}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]{width:100%;display:grid;position:relative;margin-right:10px;margin-left:5px}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]:after{content:attr(data-replicated-value) " ";white-space:pre-wrap;visibility:hidden}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container.show-cursor[_ngcontent-%COMP%]:before{content:"";width:1px;height:18px;background:#000000;display:inline-block;animation:_ngcontent-%COMP%_cursor-blink 1s steps(2) infinite;position:absolute}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%] > textarea[_ngcontent-%COMP%]{outline:none;resize:none;overflow:hidden}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::placeholder{color:#b9b9bf}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]:after, .message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%] > textarea[_ngcontent-%COMP%]{border:none;border-bottom:1px solid #d2d2d7;padding:0;font-size:15px;grid-area:1/1/2/2;font-family:Roboto}@media (max-width: 767px){.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]:after, .message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%] > textarea[_ngcontent-%COMP%]{font-size:16px}}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:50px;display:flex;justify-content:center;align-items:center;height:28px}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.message-toolbar-container[_ngcontent-%COMP%]   .message-toolbar[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer}@keyframes _ngcontent-%COMP%_cursor-blink{0%{opacity:0}}']});let t=i;return t})();function Qe(t,i){if(t&1&&(o(0,"div",1),C(1,"img",2),r()),t&2){let a=d();l(1),p("src",a.file.thumbnailUrl,N)}}function Be(t,i){if(t&1&&C(0,"img",5),t&2){let a=d(2);p("src",a.file.thumbnailUrl,N)}}function Le(t,i){if(t&1&&(o(0,"div",3)(1,"div",6)(2,"span",7),m(3,"download"),r()(),o(4,"div",8)(5,"div"),m(6),r()()()),t&2){let a=d(2);l(6),_(a.file==null?null:a.file.attachmentOriginalName)}}function ze(t,i){if(t&1){let a=w();o(0,"div",3)(1,"div",4),g("click",function(n){M(a);let s=d();return x(s.onAttachmentClick(n))}),u(2,Be,1,1,"img",5)(3,Le,7,1),r()()}if(t&2){let a=d();l(2),h(2,a.file.thumbnailUrl?2:3)}}var be=(()=>{let i=class i{constructor(){this.fileUrl="",this.fileType="UNK",this.isGif=!1,this.onAttachmentClickEmit=new b}set fileProp(e){e.attachmentMimeType?.includes("gif")&&(this.isGif=!0),this.file=e,this.fileUrl=`url("${e.thumbnailUrl}")`}onAttachmentClick(e){e.stopPropagation(),this.onAttachmentClickEmit.emit(this.file)}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-attachment"]],inputs:{fileProp:"fileProp"},outputs:{onAttachmentClickEmit:"onAttachmentClickEmit"},standalone:!0,features:[v],decls:2,vars:1,consts:[["class","flex no-wrap pa-xs"],[1,"flex","no-wrap","pa-xs"],["alt","",1,"gif-message",3,"src"],[1,"flex","no-wrap"],[1,"attachment-container",3,"click"],["alt","",3,"src"],[1,"download"],[1,"material-symbols-outlined","text-primary"],[1,"file-name","flex","column","ml-sm"]],template:function(n,s){n&1&&u(0,Qe,2,1,"div",0)(1,ze,4,1),n&2&&h(0,s.isGif?0:1)},styles:[".attachment-container[_ngcontent-%COMP%]:hover{border-radius:10px;cursor:pointer}.attachment-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}.gif-message[_ngcontent-%COMP%]{width:100%;height:auto}.download-btn[_ngcontent-%COMP%]{width:30px;display:flex;justify-content:center;align-items:flex-start;cursor:pointer}"]});let t=i;return t})();var qe=t=>({disabled:t});function Ge(t,i){if(t&1){let a=w();o(0,"div",2),g("click",function(){let s=M(a).$implicit,c=d();return x(c.btnClick(s.action))}),o(1,"div",3),m(2),r()()}if(t&2){let a=i.$implicit,e=d();p("ngClass",S(2,qe,a.action==e.disable)),l(2),_(a.icon)}}var Te=(()=>{let i=class i{constructor(){this.disable="",this.menuItems=[],this.menuActionEmit=new b}set viewedProp(e){e&&(this.disable="delete")}btnClick(e){this.menuActionEmit.emit(e)}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-float-menu-horizontal"]],inputs:{menuItems:"menuItems",viewedProp:"viewedProp"},outputs:{menuActionEmit:"menuActionEmit"},standalone:!0,features:[v],decls:4,vars:0,consts:[[1,"float-menu","show-on-hover-child"],[1,"flex","no-wrap"],[1,"menu-btn",3,"ngClass","click"],[1,"material-symbols-outlined"],["class","menu-btn",3,"ngClass"]],template:function(n,s){n&1&&(o(0,"div",0)(1,"div",1),A(2,Ge,3,4,"div",4,V),r()()),n&2&&(l(2),U(s.menuItems))},dependencies:[j]});let t=i;return t})();function Ke(t,i){if(t&1&&(o(0,"div",3)(1,"div")(2,"div",4),m(3),D(4,"date"),r(),o(5,"div",5),m(6),r()()()),t&2){let a=i.$implicit;l(3),_(R(4,2,a.createdAt,"MM/dd/yy, HH:mm")),l(3),_(a.message)}}function Ye(t,i){if(t&1&&(o(0,"div",2),A(1,Ke,7,5,"div",6,V),r()),t&2){let a=d(2);l(1),U(a.messageHistory)}}function We(t,i){if(t&1){let a=w();o(0,"button",0),g("click",function(){M(a);let n=d();return x(n.onMessageHistoryClick())}),m(1,"Edited"),r(),u(2,Ye,3,0,"div",1)}if(t&2){let a=d();l(2),h(2,a.showMessageHistory?2:-1)}}var we=(()=>{let i=class i{constructor(){this.showMessageHistory=!1,this.messageHistory=[]}onMessageHistoryClick(){console.log("edi"),this.showMessageHistory=!this.showMessageHistory}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-message-history"]],inputs:{messageHistory:"messageHistory"},standalone:!0,features:[v],decls:1,vars:1,consts:[[1,"cta-btn","edited-link",3,"click"],["class","message-history-container"],[1,"message-history-container"],[1,"message-history"],[1,"history-date"],[1,"history-text"],["class","message-history"]],template:function(n,s){n&1&&u(0,We,3,1),n&2&&h(0,s.messageHistory.length>0?0:-1)},dependencies:[$]});let t=i;return t})();var Ze=t=>({"background-image":t});function Je(t,i){if(t&1&&C(0,"div",3),t&2){let a=d(2);p("ngStyle",S(1,Ze,"url("+a.replyToMessage.thumbnailUrl+")"))}}function Xe(t,i){if(t&1&&(o(0,"div",4),m(1),r(),o(2,"div",5),m(3),r()),t&2){let a=d(2);l(1),B("",a.user==null?null:a.user.firstName," ",a.user==null?null:a.user.lastName,""),l(2),_(a.replyToMessage.replyToMessage)}}function et(t,i){if(t&1&&(o(0,"div",4),m(1),r(),o(2,"div",5),m(3),r()),t&2){let a=d(2);l(1),B("",a.receiver==null?null:a.receiver.firstName," ",a.receiver==null?null:a.receiver.lastName,""),l(2),_(a.replyToMessage.replyToMessage)}}function tt(t,i){if(t&1){let a=w();o(0,"div",1),g("click",function(){M(a);let n=d();return x(n.goToMessage())}),u(1,Je,1,3,"div",2),o(2,"div"),u(3,Xe,4,3)(4,et,4,3),r()()}if(t&2){let a=d();l(1),h(1,a.replyToMessage.thumbnailUrl?1:-1),l(2),h(3,(a.replyToMessage==null?null:a.replyToMessage.originalMessageCreatedBy)==(a.user==null?null:a.user.userId)?3:4)}}var Ee=(()=>{let i=class i{constructor(){this.goToMesaageEmit=new b}goToMessage(){this.goToMesaageEmit.next()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-reply-to-message"]],inputs:{replyToMessage:"replyToMessage",user:"user",receiver:"receiver"},outputs:{goToMesaageEmit:"goToMesaageEmit"},standalone:!0,features:[v],decls:1,vars:1,consts:[["class","reply-to-details flex"],[1,"reply-to-details","flex",3,"click"],["class","file-image mr-sm",3,"ngStyle"],[1,"file-image","mr-sm",3,"ngStyle"],[1,"truncated","text-primary"],[1,"truncated"]],template:function(n,s){n&1&&u(0,tt,5,2,"div",0),n&2&&h(0,s.replyToMessage.replyToMessageId?0:-1)},dependencies:[H]});let t=i;return t})();var it=["messageContent"];function nt(t,i){t&1&&(o(0,"span",16),m(1,"done_all"),r())}function st(t,i){t&1&&(o(0,"span",16),m(1,"done"),r())}function at(t,i){t&1&&C(0,"div",17)}function ot(t,i){if(t&1){let a=w();o(0,"app-attachment",18),g("onAttachmentClickEmit",function(n){M(a);let s=d();return x(s.onAttachmentClick(n))}),r()}if(t&2){let a=i.$implicit;p("fileProp",a)}}function rt(t,i){t&1&&(o(0,"div",19),C(1,"div",20),r())}var lt=(t,i)=>[t,i],ct=t=>[t],mt=t=>({"text-bold":t}),Se=(()=>{let i=class i{constructor(){this.replyService=T(W),this.messageService=T(Q),this.message={},this.messageType="",this.parent=null,this.highlight="",this.showFloatMenu="",this.isMobile=!1,this.menuItems=[],this.menuItemsIn=[{label:"Reply",action:"reply",icon:"reply"}],this.menuItemsOut=[{label:"Edit",action:"edit",icon:"edit"},{label:"Reply",action:"reply",icon:"reply"},{label:"Delete",action:"delete",icon:"delete"}],this.last=!1,this.onMessageIntersect=new b,this.onAttachmentClickEmit=new b}set scrollIntoViewProp(e){e?(this.messageContent.nativeElement.scrollIntoView({block:"center",behavior:"smooth"}),this.highlight="highlight-message"):this.highlight=""}set message$(e){this.message=e,this.user.userId==this.message.createdBy?(this.messageType="out",this.menuItems=this.menuItemsOut):(this.messageType="in",this.menuItems=this.menuItemsIn)}ngOnInit(){}ngAfterViewInit(){this.isViewdChecker(),this.index==0&&this.messageType=="out"&&this.messageContent.nativeElement.scrollIntoView(),this.last&&this.setLastMessageObserver()}setLastMessageObserver(){let e=new IntersectionObserver(n=>{let s=n[0];s.isIntersecting&&(this.messageService.loadNewChunkOfMessages(),e.unobserve(s.target))},{rootMargin:"200px"});e.observe(this.messageContent.nativeElement)}isViewdChecker(){if(!this.message.viewed&&this.messageType!=="out"&&this.messageContent!==void 0){let n=new IntersectionObserver(s=>{s.forEach(c=>{c.isIntersecting&&(this.onMessageIntersect.emit(this.message.messageId),n.disconnect())})},{threshold:1});n.observe(this.messageContent.nativeElement)}this.message.viewed}onAttachmentClick(e){this.onAttachmentClickEmit.emit(e)}menuActionHandle(e){console.log(e),e=="reply"?(this.message.receiver=this.receiver,this.replyService.replyToMessage(this.message)):e=="edit"&&this.replyService.editMessage(this.message),this.showFloatMenu=""}goToMessage(){this.messageService.updateMessageScrollIntoViewProperty(this.message.replyToMessage?.replyToMessageId,this.messageService.messages())}onMenuClick(){window.matchMedia("(min-width: 1025px)").matches||(this.showFloatMenu="hold",setTimeout(()=>{this.showFloatMenu=""},2e3))}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-message"]],viewQuery:function(n,s){if(n&1&&k(it,5),n&2){let c;O(c=F())&&(s.messageContent=c.first)}},inputs:{user:"user",receiver:"receiver",index:"index",last:"last",scrollIntoViewProp:"scrollIntoViewProp",message$:"message$"},outputs:{onMessageIntersect:"onMessageIntersect",onAttachmentClickEmit:"onAttachmentClickEmit"},standalone:!0,features:[v],decls:25,vars:26,consts:[[1,"message-container",3,"ngClass"],[1,"message-avatar"],[1,"message-content"],["messageContent",""],[1,"message-heading"],[1,"message-author"],[1,"more-horiz","show-on-hover-parent",3,"ngClass"],[3,"menuItems","viewedProp","menuActionEmit"],[1,"material-symbols-outlined","text-primary",3,"click"],[1,"message-date"],["class","material-symbols-outlined text-primary done-all"],[1,"message-text",3,"ngClass"],[3,"replyToMessage","receiver","user","goToMesaageEmit"],[3,"messageHistory"],["class","mb-sm"],["class","flex justify-center items-center py-sm px-xxl"],[1,"material-symbols-outlined","text-primary","done-all"],[1,"mb-sm"],[3,"fileProp","onAttachmentClickEmit"],[1,"flex","justify-center","items-center","py-sm","px-xxl"],[1,"dot-flashing"],[3,"fileProp"]],template:function(n,s){n&1&&(o(0,"div",0),C(1,"div",1),o(2,"div",2,3)(4,"div",4)(5,"span",5),m(6),r(),o(7,"span",6)(8,"app-float-menu-horizontal",7),g("menuActionEmit",function(y){return s.menuActionHandle(y)}),r(),o(9,"span",8),g("click",function(){return s.onMenuClick()}),m(10,"more_horiz"),r()(),o(11,"span",9),m(12),D(13,"date"),r(),u(14,nt,2,0,"span",10)(15,st,2,0),r(),o(16,"div",11)(17,"app-reply-to-message",12),g("goToMesaageEmit",function(){return s.goToMessage()}),r(),C(18,"app-message-history",13),o(19,"div"),m(20),r(),u(21,at,1,0,"div",14),A(22,ot,1,1,"app-attachment",21,V),u(24,rt,2,0,"div",15),r()()()),n&2&&(p("ngClass",z(19,lt,s.messageType,s.highlight)),l(6),B(" ",s.receiver==null?null:s.receiver.firstName," ",s.receiver==null?null:s.receiver.lastName," "),l(1),p("ngClass",S(22,ct,s.showFloatMenu)),l(1),p("menuItems",s.menuItems)("viewedProp",s.message.viewed),l(4),_(R(13,16,s.message.createdAt,"HH:mm")),l(2),h(14,s.message.viewed?14:15),l(2),p("ngClass",S(24,mt,!s.message.viewed&&s.messageType=="in")),l(1),p("replyToMessage",s.message.replyToMessage)("receiver",s.receiver)("user",s.user),l(1),p("messageHistory",s.message.messageHistory),l(2),_(s.message.message),l(1),h(21,s.message.attachments&&s.message.attachments.length>0?21:-1),l(1),U(s.message.attachments),l(2),h(24,s.message.totalUploads&&s.message.totalUploads>0&&s.messageType=="out"?24:-1))},dependencies:[j,$,be,Te,we,Ee]});let t=i;return t})();var dt=(t,i)=>({"fade-anim":t,in:i});function pt(t,i){if(t&1){let a=w();o(0,"div",1),g("click",function(){M(a);let n=d();return x(n.closeModal())}),o(1,"div",2)(2,"span",3),m(3,"close"),r(),o(4,"div",4),g("click",function(n){M(a);let s=d();return x(s.preventClick(n))}),oe(5),r()()()}if(t&2){let a=d();p("ngClass",z(1,dt,a.fadeAnim,a.fadeIn))}}var gt=["*"],Ie=(()=>{let i=class i{constructor(){this.modalValue=!1,this.fadeAnim=!1,this.fadeIn=!1,this.modalChange=new b}get modal(){return this.modalValue}set modal(e){e?(this.fadeAnim=!0,setTimeout(()=>{this.fadeIn=!0})):(this.fadeIn=!1,setTimeout(()=>{this.fadeAnim=!1})),this.modalValue=e,this.modalChange.emit(this.modalValue)}closeModal(){this.modal=!1}preventClick(e){e.stopPropagation()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-attachment-modal"]],inputs:{modal:"modal"},outputs:{modalChange:"modalChange"},standalone:!0,features:[v],ngContentSelectors:gt,decls:1,vars:1,consts:[["role","dialog","class","attachment-modal",3,"ngClass"],["role","dialog",1,"attachment-modal",3,"ngClass","click"],[1,"attachment-modal-content"],[1,"material-symbols-outlined","attachment-modal-close"],[3,"click"]],template:function(n,s){n&1&&(ae(),u(0,pt,6,4,"div",0)),n&2&&h(0,s.modalValue?0:-1)},dependencies:[j]});let t=i;return t})();var ut=["downloadLink"],Pe=(()=>{let i=class i{constructor(){this.src=""}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-video"]],viewQuery:function(n,s){if(n&1&&k(ut,5),n&2){let c;O(c=F())&&(s.downloadLink=c.first)}},inputs:{src:"src"},standalone:!0,features:[v],decls:1,vars:1,consts:[["alt","","controls","",3,"src"]],template:function(n,s){n&1&&C(0,"video",0),n&2&&p("src",s.src,N)}});let t=i;return t})();var ht=["messageContainer"],ft=["messagesCard"],_t=["downloadLink"],vt=(t,i)=>i.messageId;function Ct(t,i){if(t&1&&(o(0,"div",16),m(1),D(2,"date"),r()),t&2){let a=d().$implicit;l(1),_(R(2,1,a.createdAt,"dd/MM/YYYY, EEEE"))}}function yt(t,i){if(t&1){let a=w();o(0,"app-message",14),g("onMessageIntersect",function(n){M(a);let s=d();return x(s.onMessageIntersect(n))})("onAttachmentClickEmit",function(n){M(a);let s=d();return x(s.onAttachmentClick(n))}),r(),u(1,Ct,3,4,"div",15)}if(t&2){let a=i.$implicit,e=i.$index,n=i.$count,s=d();p("scrollIntoViewProp",a.highlightMessageOnScrollIntoView)("last",e===n-1)("user",s.user.user)("message$",a)("receiver",s.receiver)("index",e),l(1),h(1,s.displayDate(e,a.createdAt)?1:-1)}}var Mt=t=>({"new-message":t}),pn=(()=>{let i=class i{constructor(){this.messageService=T(Q),this.subjectService=T(K),this.navigation=T(fe),this.chatService=T(Y),this.auth=T(q),this.clientService=T(pe),this.providerService=T(ge),this._subscription=new L,this.user=this.auth.user(),this.messages=this.messageService.messages,this.chunkNum=1,this.containerBorder=!1,this.receiver={},this.attachmentUrl="",this.toggleImageModal=!1,this.toggleVideoModal=!1}ngOnInit(){this.getReceiverDeatils(),this.getMessages()}ngAfterViewInit(){this.messagesCard.nativeElement.addEventListener("scroll",()=>{})}getMessages(){this.messageService.resetMessages(),this.subject=this.subjectService.getSubjectFromLocal(),this.subject||this.navigation.back(),this.messageService.getMessages(this.subject.subjectId,1).subscribe({next:e=>{this.messageService.addMessages(e)},error:e=>{console.log(e)}})}displayDate(e,n){return e==this.messages.length-1?!1:this.getLocalDate(n)!=this.getLocalDate(this.messages()[e+1]?.createdAt)}getLocalDate(e){return e?new Date(e).toLocaleDateString():""}onMessageIntersect(e){let n={accessToken:this.user?.accessToken,messageId:e};this.chatService.sendViewedMessageConfirmation(n)}getReceiverDeatils(){if(this.auth.user().user?.isClient){let e=this.providerService.getProvider();e.providerUserId&&(this.receiver={receiverId:e.providerUserId,firstName:e.firstName,lastName:e.lastName})}else{let e=this.clientService.getClient();e?.clientUserId&&(this.receiver={receiverId:e.clientUserId,firstName:e.firstName,lastName:e.lastName})}}onAttachmentClick(e){this.messageService.getAttachmentUrl(e.messageAttachmentId).subscribe({next:n=>{console.log(n),this.attachmentUrl=n.attachmentUrl,this.processAttachment(e)},error:n=>{console.log(n)}})}processAttachment(e){e.attachmentMimeType?.includes("video")&&!e.attachmentMimeType?.includes("avi")?this.toggleVideoModal=!0:e.attachmentThumbnailId==null||e.attachmentMimeType?.includes("avi")?this.downloadAttachment(e.attachmentOriginalName):this.toggleImageModal=!0}downloadAttachment(e){this.downloadLink.nativeElement.href=this.attachmentUrl,this.downloadLink.nativeElement.click()}containerHighlight(){console.log("hhh"),this.containerBorder=!0,setTimeout(()=>{this.containerBorder=!1},500)}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=f({type:i,selectors:[["app-messages"]],viewQuery:function(n,s){if(n&1&&(k(ht,5),k(ft,5),k(_t,5)),n&2){let c;O(c=F())&&(s.messageContainer=c.first),O(c=F())&&(s.messagesCard=c.first),O(c=F())&&(s.downloadLink=c.first)}},standalone:!0,features:[v],decls:18,vars:12,consts:[[1,"container","container-md"],["messageContainer",""],[1,"messages-container",3,"ngClass"],[1,"message-container-header","flex","items-center","no-wrap"],[3,"color"],[1,"ml-auto"],[1,"card","pa-xl"],["messagesCard",""],[3,"receiverId"],[3,"modal","modalChange"],["alt","",3,"src"],[3,"src"],[1,"hidden"],["downloadLink",""],[3,"scrollIntoViewProp","last","user","message$","receiver","index","onMessageIntersect","onAttachmentClickEmit"],["class","date-separator"],[1,"date-separator"]],template:function(n,s){n&1&&(o(0,"div",0,1)(2,"div",2)(3,"div",3),C(4,"app-back-button",4),o(5,"h4",5),m(6),r()(),o(7,"div",6,7),A(9,yt,2,7,null,null,vt),r(),C(11,"app-message-toolbar",8),r()(),o(12,"app-attachment-modal",9),g("modalChange",function(y){return s.toggleImageModal=y}),C(13,"img",10),r(),o(14,"app-attachment-modal",9),g("modalChange",function(y){return s.toggleVideoModal=y}),C(15,"app-video",11),r(),C(16,"a",12,13)),n&2&&(l(2),p("ngClass",S(10,Mt,s.containerBorder)),l(2),se("my-sm"),p("color","white"),l(2),_(s.subject.title),l(3),U(s.messages()),l(2),p("receiverId",s.receiver.receiverId),l(1),p("modal",s.toggleImageModal),l(1),p("src",s.attachmentUrl,N),l(1),p("modal",s.toggleVideoModal),l(1),p("src",s.attachmentUrl))},dependencies:[xe,Se,he,$,j,Ie,Pe],styles:[".messages-container[_ngcontent-%COMP%]{height:calc(100vh - 140px);display:flex;flex-direction:column;border-radius:13px;border:2px solid transparent;box-shadow:0;transition:border .5s;margin-top:24px}.messages-container[_ngcontent-%COMP%]   .message-container-header[_ngcontent-%COMP%]{border:1px solid var(--primary);border-top-right-radius:10px;border-top-left-radius:10px;border-bottom:0;background-color:var(--primary);padding:2px 24px}.messages-container[_ngcontent-%COMP%]   .message-container-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--white)!important}.messages-container.new-message[_ngcontent-%COMP%]{border-color:#0171ad9b}.messages-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{height:100%;border-radius:0;padding:0;display:flex;flex-direction:column-reverse;overflow-y:auto}@media (max-width: 767px){.messages-container[_ngcontent-%COMP%]{position:fixed;left:0!important;right:0;bottom:0;top:60px;height:initial;margin-top:0}.messages-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border:none;border-bottom:1px solid var(--border-color)}.messages-container[_ngcontent-%COMP%]   .message-container-header[_ngcontent-%COMP%]{display:none;border:none;border-top-right-radius:0;border-top-left-radius:0}}.messages-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:12px;height:12px}@media (max-width: 767px){.messages-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:0px;height:0px}}.messages-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c4c8c7;border-radius:15px;border:5px solid #fff}@media (max-width: 767px){.messages-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border:0px}}.messages-container[_ngcontent-%COMP%]   .date-separator[_ngcontent-%COMP%]{border-top:1px solid var(--border-color);color:var(--primary);text-align:center;margin-top:24px;padding-top:10px;font-size:14px}"]});let t=i;return t})();export{pn as MessagesComponent};
