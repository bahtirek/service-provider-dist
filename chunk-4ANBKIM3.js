import{a as ce}from"./chunk-2SC7YGOI.js";import{a as L,b as R}from"./chunk-ZVW5MEVP.js";import{a as oe}from"./chunk-F5KWCBV7.js";import{a as re,b as le}from"./chunk-G3M5E6AV.js";import{a as $}from"./chunk-I4ETGNFX.js";import{a as Q}from"./chunk-O6KTZ5NC.js";import{a as se}from"./chunk-C2QTALJL.js";import"./chunk-AOEJRZ7Y.js";import{b as ne,d as ie,f as ae,q as z}from"./chunk-MBTLH6JK.js";import{c as U,e as V,f as B}from"./chunk-YKD7L7GY.js";import{$ as O,$a as m,Aa as b,Fa as d,Ka as C,La as _,Ma as D,Na as T,Oa as E,Pa as o,Qa as r,Ra as u,Sa as F,T as f,V as h,Wa as p,Xa as g,Y as K,Ya as Z,Za as J,_ as I,ab as x,bb as W,cb as X,gb as v,ib as w,jb as ee,kb as A,lb as te,mb as N,na as G,ob as y,pb as S,ra as H,rb as P,ta as Y,xa as l}from"./chunk-BWQSIJDM.js";import"./chunk-JMZ7DUBM.js";var me=(()=>{let a=class a{transform(t){let e=(t/1024).toFixed(2)+" KB";return t>1048576&&(e=(t/(1024*1024)).toFixed(2)+" MB"),e}};a.\u0275fac=function(e){return new(e||a)},a.\u0275pipe=K({name:"fileSize",type:a,pure:!0,standalone:!0});let i=a;return i})();var Ce=i=>({"background-image":i});function _e(i,a){if(i&1&&u(0,"div",4),i&2){let c=g();d("ngStyle",w(1,Ce,c.fileUrl))}}function ve(i,a){if(i&1&&(o(0,"div",5)(1,"div",6)(2,"span"),m(3),r()()()),i&2){let c=g();l(3),x(c.fileType)}}var de=(()=>{let a=class a{constructor(){this.fileUrl="",this.fileType="UNK"}set fileProp(t){if(this.fileType=this.setFileType(t.type),console.log(this.fileType),this.file=t,this.fileType!="IMG")return;let e=new FileReader;e.onload=n=>{n.target&&(this.fileUrl=`url("${n.target.result}")`)},e.readAsDataURL(t)}setFileType(t){return t.includes("image")?"IMG":t.includes("pdf")?"PDF":t.includes("zip")?"ZIP":t.includes("document")?"DOC":"UNK"}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-file-details"]],inputs:{fileProp:"fileProp"},standalone:!0,features:[v],decls:9,vars:5,consts:[[1,"flex","no-wrap","mb-sm"],["class","file-image",3,"ngStyle"],[1,"flex","column","justify-around","ml-md"],[1,"body2"],[1,"file-image",3,"ngStyle"],[1,"file-image"],[1,"file-type"]],template:function(e,n){e&1&&(o(0,"div",0),C(1,_e,1,3,"div",1)(2,ve,4,1),o(3,"div",2)(4,"div"),m(5),r(),o(6,"div",3),m(7),A(8,"fileSize"),r()()()),e&2&&(l(1),_(1,n.fileType=="IMG"?1:2),l(4),x(n.file==null?null:n.file.name),l(2),x(te(8,3,n.file==null?null:n.file.size)))},dependencies:[me,V]});let i=a;return i})();function xe(i,a){if(i&1&&(o(0,"h3",7),m(1),r()),i&2){let c=g();l(1),W("",c.files.length," files selected")}}function Me(i,a){if(i&1&&u(0,"app-file-details",8),i&2){let c=a.$implicit;d("fileProp",c)}}var pe=(()=>{let a=class a{constructor(){this.comment="",this.cancel=new b,this.onFileUpload=new b}set filesProp(t){this.files=t}onCancel(){this.cancel.emit(!0)}onSend(){this.onFileUpload.emit(this.comment.trim())}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-file-upload"]],inputs:{filesProp:"filesProp"},outputs:{cancel:"cancel",onFileUpload:"onFileUpload"},standalone:!0,features:[v],decls:13,vars:2,consts:[["class","mb-lg"],[1,"form-element","mt-xxl"],["for","sessionTitle"],["type","text","id","sessionTitle",3,"ngModel","ngModelChange"],[1,"flex","mt-xl","btn-group"],[1,"block","ml-auto","btn-danger",3,"click"],[1,"block","ml-lg",3,"click"],[1,"mb-lg"],[3,"fileProp"]],template:function(e,n){e&1&&(o(0,"div"),C(1,xe,2,1,"h3",0),T(2,Me,1,1,"app-file-details",8,D),o(4,"div",1)(5,"label",2),m(6,"Comment"),r(),o(7,"input",3),p("ngModelChange",function(M){return n.comment=M}),r()(),o(8,"div",4)(9,"button",5),p("click",function(){return n.onCancel()}),m(10,"Cancel"),r(),o(11,"button",6),p("click",function(){return n.onSend()}),m(12,"Send"),r()()()),e&2&&(l(1),_(1,n.files&&n.files.length>0?1:-1),l(1),E(n.files),l(5),d("ngModel",n.comment))},dependencies:[z,ne,ie,ae,de]});let i=a;return i})();var be=["textAreaContainer"],ye=["textArea"],Se=["fileUpload"],ge=(()=>{let a=class a{constructor(){this.renderer=f(H),this.auth=f(Q),this.chatService=f(R),this.subjectService=f($),this.messageService=f(L),this.message="",this.showCursor=!0,this.toggleModal=!1,this.uploadInprogress=Y(0),this.receiverId="",this.MB20=1024*1024*20,this.MB80=1024*1024*80,this.MB100=1024*1024*100}ngOnInit(){this.getSubjectDetails()}getSubjectDetails(){let t=this.subjectService.getSubjectFromLocal();t&&(this.subjectId=t.subjectId,this.chatService.setSubjectId(this.subjectId))}onSubmit(){if(!this.subjectId||!this.receiverId)return;let t=this.textAreaContainer.nativeElement.dataset.replicatedValue?.trim();if(!t)return;let e={subjectId:this.subjectId,message:t,accessToken:this.auth.user().accessToken,toUserId:this.receiverId};this.chatService.sendMessage(e),this.resetMessageInputField()}resetMessageInputField(){this.renderer.setAttribute(this.textAreaContainer.nativeElement,"data-replicated-value",""),this.textArea.nativeElement.value="",this.showCursor=!0}onAttach(){let t=/(\.jpg|\.jpeg|\.bmp|\.gif|\.svg|\.png|\.webm|\.avi|\.mpeg|\.mkv|\.doc|\.docx|\.xls|\.xlsx|\.pdf)$/i,e=this.fileUpload.nativeElement.files;console.log(e),e&&e.length>0&&(this.files=e,this.toggleModal=!0)}onBlur(){this.textArea.nativeElement.value?this.showCursor=!1:this.showCursor=!0}onFileUpload(t){if(!this.files||this.files.length==0)return;let e=new FormData;[...this.files].forEach(s=>{e.append("files",s)});let n={subjectId:this.subjectId,message:t,accessToken:this.auth.user().accessToken,toUserId:this.receiverId,isAttachment:!0};e.append("message",JSON.stringify(n)),this.messageService.uploadFile(e).subscribe({next:s=>{s.messageId&&this.messageService.addMessage(s),this.cancel()},error:s=>{console.log(s)}})}onFileUploads(t){this.cancel();let e=[],n=0,s=0;if(!this.files||this.files.length==0)return;let M=new FormData;[...this.files].forEach(j=>{if(j.size<this.MB20&&s<this.MB20)M.append("files",j),e[n]=M,s=s+j.size,s>this.MB20&&(n=e.length,s=0);else{let q=new FormData;q.append("files",j),e[e.length]=q}}),this.submitAttachmentMessage(e,t)}submitAttachmentMessage(t,e){let n={subjectId:this.subjectId,message:e,accessToken:this.auth.user().accessToken,toUserId:this.receiverId,isAttachment:!0};this.messageService.postAttachmentMessage(n).subscribe({next:s=>{console.log(s),s.totalUploads=t.length,this.messageService.addMessage(s),s.messageId&&this.submitFiles(t,s.messageId)},error:s=>{console.log()}})}submitFiles(t,e){t.forEach(n=>{console.log(n),n.append("messageId",e),console.log(n),this.messageService.uploadFile(n).subscribe({next:s=>{this.messageService.updateMessage(s)},error:s=>{console.log(s)}})})}onFocus(){this.showCursor=!1}cancel(){this.toggleModal=!1}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-message-toolbar"]],viewQuery:function(e,n){if(e&1&&(S(be,5),S(ye,5),S(Se,5)),e&2){let s;y(s=P())&&(n.textAreaContainer=s.first),y(s=P())&&(n.textArea=s.first),y(s=P())&&(n.fileUpload=s.first)}},inputs:{receiverId:"receiverId"},standalone:!0,features:[v],decls:16,vars:2,consts:[[1,"message-toolbar"],[1,"text-container"],["textAreaContainer",""],["onInput","this.parentNode.dataset.replicatedValue = this.value","rows","1","placeholder","Send message",3,"focus","blur"],["textArea",""],[1,"action-btn"],[1,"material-symbols-outlined","text-primary",3,"click"],["for","attach"],[1,"material-symbols-outlined","text-primary"],["type","file","id","attach","accept","image/*, .pdf, .doc, .docx","multiple","",1,"hidden",3,"input"],["fileUpload",""],[3,"modal","modalChange"],[3,"filesProp","cancel","onFileUpload"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1,2)(3,"textarea",3,4),p("focus",function(){return n.onFocus()})("blur",function(){return n.onBlur()}),r()(),o(5,"div",5)(6,"span",6),p("click",function(){return n.onSubmit()}),m(7,"send"),r()(),o(8,"div",5)(9,"label",7)(10,"span",8),m(11,"attach_file"),r()(),o(12,"input",9,10),p("input",function(){return n.onAttach()}),r()()(),o(14,"app-modal",11),p("modalChange",function(M){return n.toggleModal=M}),o(15,"app-file-upload",12),p("cancel",function(){return n.cancel()})("onFileUpload",function(M){return n.onFileUploads(M)}),r()()),e&2&&(l(14),d("modal",n.toggleModal),l(1),d("filesProp",n.files))},dependencies:[z,oe,pe],styles:['.message-toolbar[_ngcontent-%COMP%]{border:1px solid #d2d2d7;border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;min-height:46px;display:flex;flex-wrap:nowrap;align-items:flex-end;justify-content:space-around;padding:10px 10px 12px 30px;background-color:#fff}@media (max-width: 767px){.message-toolbar[_ngcontent-%COMP%]{border:none}}.message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]{width:100%;display:grid;position:relative;margin-right:10px}.message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]:after{content:attr(data-replicated-value) " ";white-space:pre-wrap;visibility:hidden}.message-toolbar[_ngcontent-%COMP%]   .text-container.show-cursor[_ngcontent-%COMP%]:before{content:"";width:1px;height:18px;background:#000000;display:inline-block;animation:_ngcontent-%COMP%_cursor-blink 1s steps(2) infinite;position:absolute}.message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%] > textarea[_ngcontent-%COMP%]{outline:none;resize:none;overflow:hidden}.message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::placeholder{color:#b9b9bf}.message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]:after, .message-toolbar[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%] > textarea[_ngcontent-%COMP%]{border:none;border-bottom:1px solid #d2d2d7;padding:0;font-size:15px;grid-area:1/1/2/2;font-family:Roboto}.message-toolbar[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:50px;display:flex;justify-content:center;align-items:center;height:28px}.message-toolbar[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.message-toolbar[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer}@keyframes _ngcontent-%COMP%_cursor-blink{0%{opacity:0}}']});let i=a;return i})();var Pe=i=>({"background-image":i});function we(i,a){if(i&1&&u(0,"div",3),i&2){let c=g();d("ngStyle",w(1,Pe,c.fileUrl))}}function Ie(i,a){if(i&1&&(o(0,"div",4)(1,"div",5)(2,"span"),m(3),r()()()),i&2){let c=g();l(3),x(c.fileType)}}var ue=(()=>{let a=class a{constructor(){this.fileUrl="",this.fileType="UNK",this.onAttachmentClickEmit=new b}set fileProp(t){t.thumbnailUrl==null&&(this.fileType=this.setFileType(t.attachmentOriginalName)),this.file=t,this.fileUrl=`url("${t.thumbnailUrl}")`,console.log(t.thumbnailUrl)}onAttachmentClick(){this.onAttachmentClickEmit.emit(this.file)}setFileType(t){let e=t.split("."),n=e[e.length-1];return console.log(e),console.log(n),n.includes("jpg")?"IMG":n.includes("pdf")?"PDF":n.includes("zip")?"ZIP":n.includes("doc")?"DOC":"UNK"}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-attachment"]],inputs:{fileProp:"fileProp"},outputs:{onAttachmentClickEmit:"onAttachmentClickEmit"},standalone:!0,features:[v],decls:6,vars:2,consts:[[1,"flex","no-wrap","pa-xs","attachment-container",3,"click"],["class","file-image",3,"ngStyle"],[1,"file-name","flex","column","ml-sm"],[1,"file-image",3,"ngStyle"],[1,"file-image"],[1,"file-type"]],template:function(e,n){e&1&&(o(0,"div",0),p("click",function(){return n.onAttachmentClick()}),C(1,we,1,3,"div",1)(2,Ie,4,1),o(3,"div",2)(4,"div"),m(5),r()()()),e&2&&(l(1),_(1,n.file.thumbnailUrl?1:2),l(4),x(n.file==null?null:n.file.attachmentOriginalName))},dependencies:[V],styles:[".attachment-container[_ngcontent-%COMP%]{width:min(400px,100%);margin-left:auto}.attachment-container[_ngcontent-%COMP%]:hover{background-color:#fffefe;border-radius:10px;cursor:pointer}"]});let i=a;return i})();var Oe=["messageContent"];function ke(i,a){i&1&&(o(0,"span",11),m(1,"done_all"),r())}function Te(i,a){i&1&&(o(0,"span",11),m(1,"done"),r())}function Ee(i,a){i&1&&u(0,"div",12)}function Fe(i,a){if(i&1){let c=F();o(0,"app-attachment",13),p("onAttachmentClickEmit",function(e){I(c);let n=g();return O(n.onAttachmentClick(e))}),r()}if(i&2){let c=a.$implicit;d("fileProp",c)}}function Ae(i,a){i&1&&(o(0,"div",14),u(1,"div",15),r())}var Ue=i=>({"text-bold":i}),fe=(()=>{let a=class a{constructor(){this.message={},this.messageType="",this.parent=null,this.onMessageIntersect=new b,this.onAttachmentClickEmit=new b}set message$(t){this.message=t,this.messageType=this.userId==this.message.createdBy?"out":"in"}ngOnInit(){}ngAfterViewInit(){this.isViewdChecker()}isViewdChecker(){if(!this.message.viewed&&this.messageType!=="out"&&this.messageContent!==void 0){let e=new IntersectionObserver(n=>{n.forEach(s=>{s.isIntersecting&&(this.onMessageIntersect.emit(this.message.messageId),e.disconnect())})},{threshold:1});e.observe(this.messageContent.nativeElement)}}onAttachmentClick(t){this.onAttachmentClickEmit.emit(t)}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-message"]],viewQuery:function(e,n){if(e&1&&S(Oe,5),e&2){let s;y(s=P())&&(n.messageContent=s.first)}},inputs:{userId:"userId",receiver:"receiver",message$:"message$"},outputs:{onMessageIntersect:"onMessageIntersect",onAttachmentClickEmit:"onAttachmentClickEmit"},standalone:!0,features:[v],decls:19,vars:14,consts:[[1,"message-container",3,"ngClass"],[1,"message-avatar"],[1,"message-content"],["messageContent",""],[1,"message-heading"],[1,"message-author"],[1,"message-date"],["class","material-symbols-outlined text-primary done-all"],[1,"message-text",3,"ngClass"],["class","mb-sm"],["class","flex justify-center items-center py-sm px-xxl"],[1,"material-symbols-outlined","text-primary","done-all"],[1,"mb-sm"],[3,"fileProp","onAttachmentClickEmit"],[1,"flex","justify-center","items-center","py-sm","px-xxl"],[1,"dot-flashing"],[3,"fileProp"]],template:function(e,n){e&1&&(o(0,"div",0),u(1,"div",1),o(2,"div",2,3)(4,"div",4)(5,"span",5),m(6),r(),o(7,"span",6),m(8),A(9,"date"),r(),C(10,ke,2,0,"span",7)(11,Te,2,0),r(),o(12,"div",8)(13,"span"),m(14),r(),C(15,Ee,1,0,"div",9),T(16,Fe,1,1,"app-attachment",16,D),C(18,Ae,2,0,"div",10),r()()()),e&2&&(d("ngClass",n.messageType),l(6),X(" ",n.receiver.firstName," ",n.receiver.lastName," "),l(2),x(N(9,9,n.message.createdAt,"HH:mm")),l(2),_(10,n.message.viewed?10:11),l(2),d("ngClass",w(12,Ue,!n.message.viewed&&n.messageType=="in")),l(2),x(n.message.message),l(1),_(15,n.message.attachments&&n.message.attachments.length>0?15:-1),l(1),E(n.message.attachments),l(2),_(18,n.message.totalUploads&&n.message.totalUploads>0?18:-1))},dependencies:[U,B,ue],styles:['.message-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;flex-wrap:nowrap;gap:8px;width:100%}.message-container[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;border:1px solid #dadce0;background-image:url("./media/bola_avatar-7CLOKH46.png");background-size:60px 60px;background-repeat:no-repeat;background-position:center}.message-container[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{white-space:pre-line;background-color:#e8f3ff;border-radius:10px;padding:5px 9px 7px;margin-top:5px;margin-right:auto;margin-left:initial;max-width:80%;font-size:14px}.message-container[_ngcontent-%COMP%]   .message-author[_ngcontent-%COMP%], .message-container[_ngcontent-%COMP%]   .message-date[_ngcontent-%COMP%]{display:inline-block;font-size:13px;color:#404040}.message-container[_ngcontent-%COMP%]   .message-date[_ngcontent-%COMP%], .message-container[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{font-size:11px;margin-left:10px}.message-container[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column}.message-container[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-heading[_ngcontent-%COMP%]   .done-all[_ngcontent-%COMP%]{display:none}.message-container.out[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{justify-content:flex-end}.message-container.out[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-heading[_ngcontent-%COMP%]{text-align:right;position:relative}.message-container.out[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-heading[_ngcontent-%COMP%]   .done-all[_ngcontent-%COMP%]{display:block;position:absolute;right:-20px;font-size:17px;top:2px}.message-container.out[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{margin-left:auto;margin-right:initial;background-color:#f3f3f3;text-align:left}.message-container.out[_ngcontent-%COMP%]   .message-author[_ngcontent-%COMP%], .message-container.out[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{display:none}']});let i=a;return i})();var je=(i,a)=>({"fade-anim":i,in:a});function De(i,a){if(i&1){let c=F();o(0,"div",1)(1,"div",2)(2,"span",3),p("click",function(){I(c);let e=g();return O(e.closeModal())}),m(3,"close"),r(),J(4),r()()}if(i&2){let c=g();d("ngClass",ee(1,je,c.fadeAnim,c.fadeIn))}}var Ne=["*"],he=(()=>{let a=class a{constructor(){this.modalValue=!1,this.fadeAnim=!1,this.fadeIn=!1,this.modalChange=new b}get modal(){return this.modalValue}set modal(t){t?(this.fadeAnim=!0,setTimeout(()=>{this.fadeIn=!0})):(this.fadeIn=!1,setTimeout(()=>{this.fadeAnim=!1})),this.modalValue=t,this.modalChange.emit(this.modalValue)}closeModal(){this.modal=!1}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-attachment-modal"]],inputs:{modal:"modal"},outputs:{modalChange:"modalChange"},standalone:!0,features:[v],ngContentSelectors:Ne,decls:1,vars:1,consts:[["role","dialog","class","attachment-modal",3,"ngClass"],["role","dialog",1,"attachment-modal",3,"ngClass"],[1,"attachment-modal-content"],[1,"material-symbols-outlined","attachment-modal-close",3,"click"]],template:function(e,n){e&1&&(Z(),C(0,De,5,4,"div",0)),e&2&&_(0,n.modalValue?0:-1)},dependencies:[U]});let i=a;return i})();var Ve=["messageContainer"],Be=["downloadLink"],Qe=(i,a)=>a.messageId;function ze(i,a){if(i&1&&(o(0,"div",13),m(1),A(2,"date"),r()),i&2){let c=g().$implicit;l(1),x(N(2,1,c.createdAt,"dd/MM/YYYY, EEEE"))}}function Le(i,a){if(i&1){let c=F();o(0,"app-message",11),p("onMessageIntersect",function(e){I(c);let n=g();return O(n.onMessageIntersect(e))})("onAttachmentClickEmit",function(e){I(c);let n=g();return O(n.onAttachmentClick(e))}),r(),C(1,ze,3,4,"div",12)}if(i&2){let c=a.$implicit,t=a.$index,e=g();d("userId",e.user.user==null?null:e.user.user.userId)("message$",c)("receiver",e.receiver),l(1),_(1,e.displayDate(t,c.createdAt)?1:-1)}}var $e=i=>({"new-message":i}),Yt=(()=>{let a=class a{constructor(){this.messageService=f(L),this.subjectService=f($),this.navigation=f(le),this.chatService=f(R),this.auth=f(Q),this.clientService=f(ce),this.providerService=f(se),this.user=this.auth.user(),this.messages=this.messageService.messages,this.chunkNum=1,this.containerBorder=!1,this.receiver={},this.attachmentUrl="",this.toggleModal=!1}ngOnInit(){this.getReceiverDeatils(),this.getMessages()}getMessages(){this.messageService.resetMessages(),this.subject=this.subjectService.getSubjectFromLocal(),this.subject||this.navigation.back(),this.messageService.getMessages(this.subject.subjectId,this.chunkNum).subscribe({next:t=>{this.messageService.addMessages(t),this.chunkNum++},error:t=>{console.log(t)}})}displayDate(t,e){return t==this.messages.length-1?!1:this.getLocalDate(e)!=this.getLocalDate(this.messages()[t+1]?.createdAt)}getLocalDate(t){return t?new Date(t).toLocaleDateString():""}onMessageIntersect(t){let e={accessToken:this.user?.accessToken,messageId:t};this.chatService.sendViewedMessageConfirmation(e)}getReceiverDeatils(){if(this.auth.user().user?.isClient){let t=this.providerService.getProvider();t.providerUserId&&(this.receiver={receiverId:t.providerUserId,firstName:t.firstName,lastName:t.lastName})}else{let t=this.clientService.getClient();t?.clientUserId&&(this.receiver={receiverId:t.clientUserId,firstName:t.firstName,lastName:t.lastName})}}onAttachmentClick(t){this.messageService.getAttachmentUrl(t.messageAttachmentId).subscribe({next:e=>{console.log(e),this.attachmentUrl=e.attachmentUrl,t.attachmentThumbnailId==null?this.downloadAttachment(t.attachmentOriginalName):this.toggleModal=!0},error:e=>{console.log(e)}})}downloadAttachment(t){this.downloadLink.nativeElement.setAttribute("download",t),this.downloadLink.nativeElement.href=this.attachmentUrl,this.downloadLink.nativeElement.click()}containerHighlight(){console.log("hhh"),this.containerBorder=!0,setTimeout(()=>{this.containerBorder=!1},500)}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=h({type:a,selectors:[["app-messages"]],viewQuery:function(e,n){if(e&1&&(S(Ve,5),S(Be,5)),e&2){let s;y(s=P())&&(n.messageContainer=s.first),y(s=P())&&(n.downloadLink=s.first)}},standalone:!0,features:[v],decls:15,vars:7,consts:[[1,"container","container-md"],["messageContainer",""],[1,"flex","items-center","no-wrap"],[1,"ml-auto"],[1,"message-container",3,"ngClass"],[1,"card","pa-xl"],[3,"receiverId"],[3,"modal","modalChange"],["alt","",3,"src"],[1,"hidden"],["downloadLink",""],[3,"userId","message$","receiver","onMessageIntersect","onAttachmentClickEmit"],["class","date-separator"],[1,"date-separator"]],template:function(e,n){e&1&&(o(0,"div",0,1)(2,"div",2),u(3,"app-back-button"),o(4,"h3",3),m(5),r()(),o(6,"div",4)(7,"div",5),T(8,Le,2,4,null,null,Qe),r(),u(10,"app-message-toolbar",6),r()(),o(11,"app-attachment-modal",7),p("modalChange",function(M){return n.toggleModal=M}),u(12,"img",8),r(),u(13,"a",9,10)),e&2&&(l(5),x(n.subject.title),l(1),d("ngClass",w(5,$e,n.containerBorder)),l(2),E(n.messages()),l(2),d("receiverId",n.receiver.receiverId),l(1),d("modal",n.toggleModal),l(1),d("src",n.attachmentUrl,G))},dependencies:[ge,fe,re,B,U,he],styles:[".message-container[_ngcontent-%COMP%]{height:calc(100vh - 180px);display:flex;flex-direction:column;border-radius:13px;border:2px solid transparent;box-shadow:0;transition:border .5s}.message-container.new-message[_ngcontent-%COMP%]{border-color:#0171ad9b}.message-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{height:100%;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:10px 32px 10px 12px;display:flex;flex-direction:column-reverse;overflow-y:auto}@media (max-width: 767px){.message-container[_ngcontent-%COMP%]{position:fixed;inset:60px 0 0;height:initial}.message-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border:none;border-bottom:1px solid #dadce0}}.message-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:12px;height:12px}.message-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c4c8c7;border-radius:15px;border:5px solid #fff}.message-container[_ngcontent-%COMP%]   .date-separator[_ngcontent-%COMP%]{border-top:1px solid #dadce0;color:var(--primary);text-align:center;margin-top:24px;padding-top:10px;font-size:14px}"]});let i=a;return i})();export{Yt as MessagesComponent};
