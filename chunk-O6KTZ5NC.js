import{h,p as u}from"./chunk-YKD7L7GY.js";import{G as o,N as p,T as n,ta as r,z as a}from"./chunk-BWQSIJDM.js";var l={production:!1,apiUrl:"https://octopus-app-omsi2.ondigitalocean.app/api",socketUrl:"https://octopus-app-omsi2.ondigitalocean.app"};var x=(()=>{let e=class e{constructor(){this.url=l.apiUrl,this.http=n(h),this.router=n(u),this.state=r({}),this.isLoggedIn=r(!1),this.user=r({}),this.getUser()}login(t){return this.http.post(this.url+"/auth/login",t).pipe(o())}refreshToken(){let t=this.user()?.accessToken;return console.log(t),this.http.post(this.url+"/auth/refresh",{accessToken:t}).pipe(a(1))}registration(t){return this.http.post(this.url+"/users/user",t).pipe(o())}logout(t){window.sessionStorage.removeItem("user"),this.state.update(s=>null),this.isLoggedIn.set(!1),t&&this.router.navigate([t])}setUser(t){window.sessionStorage.setItem("user",JSON.stringify(t)),this.user.update(()=>t),this.isLoggedIn.set(!0)}getUser(){if(window.sessionStorage.getItem("user")==null)return;let t=JSON.parse(window.sessionStorage.getItem("user"));console.log(t),this.isTokenExpired()?this.refreshTokenIfExpired():(this.user.update(()=>t),this.isLoggedIn.set(!0))}refreshTokenIfExpired(){this.isTokenExpired()&&this.refreshToken().subscribe({next:t=>{this.setUser(t)},error:t=>{this.isLoggedIn.set(!1),this.logout("login")}})}isTokenExpired(){let t=this.user()?.accessToken;if(!t)return!1;let s=JSON.parse(window.atob(t.split(".")[1])),c=Math.floor(Date.now()/1e3);return!(s.exp-c>10)}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();export{x as a};
